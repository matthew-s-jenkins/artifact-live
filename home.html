<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artifact Live - My Businesses</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- External Theme Stylesheet -->
    <link rel="stylesheet" href="themes.css">
</head>
<body class="bg-gray-900" data-theme="cyan">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Using relative URLs now that we're serving from Flask
        const API_BASE_URL = '';

        function HomePage() {
            const [user, setUser] = useState(null);
            const [businesses, setBusinesses] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showNewBusinessModal, setShowNewBusinessModal] = useState(false);
            const [theme, setTheme] = useState('cyan');

            useEffect(() => {
                checkAuth();
                // Load saved theme
                const savedTheme = localStorage.getItem('artifact_theme') || 'cyan';
                setTheme(savedTheme);
                document.body.setAttribute('data-theme', savedTheme);
                document.body.className = 'bg-gradient-custom';
            }, []);

            const handleThemeChange = (newTheme) => {
                setTheme(newTheme);
                localStorage.setItem('artifact_theme', newTheme);
                document.body.setAttribute('data-theme', newTheme);
            };

            const checkAuth = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/check_auth`, {
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const data = await response.json();
                        setUser(data.user);
                        loadBusinesses();
                    } else {
                        window.location.href = '/';
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    window.location.href = '/';
                }
            };

            const loadBusinesses = async () => {
                setLoading(true);
                // TODO: Implement API endpoint to fetch businesses
                // For now, use mock data
                setTimeout(() => {
                    setBusinesses([
                        { id: 1, name: 'Keyboard Kingdom', type: 'KEYBOARD_SHOP', description: 'Custom mechanical keyboards and components' },
                        { id: 2, name: 'Microcontroller Depot', type: 'ELECTRONICS', description: 'Electronics parts and project planning' }
                    ]);
                    setLoading(false);
                }, 500);
            };

            const handleLogout = async () => {
                try {
                    await fetch(`${API_BASE_URL}/api/logout`, {
                        method: 'POST',
                        credentials: 'include'
                    });
                    window.location.href = '/';
                } catch (error) {
                    console.error('Logout failed:', error);
                }
            };

            const openBusiness = (businessId) => {
                window.location.href = `/dashboard.html?business_id=${businessId}`;
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-gray-600">Loading...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="card-bg border-b">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-2xl font-bold text-white">Artifact Live</h1>
                                    <p className="text-sm text-gray-300">Welcome back, {user?.username || 'User'}</p>
                                </div>
                                <div className="flex items-center space-x-4">
                                    {/* Theme Selector */}
                                    <select
                                        value={theme}
                                        onChange={(e) => handleThemeChange(e.target.value)}
                                        className="card-bg text-white px-3 py-2 border rounded-md text-sm focus:outline-none"
                                    >
                                        <option value="cyan">Cyan/Blue</option>
                                        <option value="tan">Tan/Amber</option>
                                        <option value="purple">Purple/Violet</option>
                                        <option value="emerald">Emerald/Green</option>
                                        <option value="rose">Rose/Pink</option>
                                        <option value="slate">Slate/Gray</option>
                                    </select>
                                    <button
                                        onClick={handleLogout}
                                        className="px-4 py-2 text-sm font-medium text-gray-300 hover:text-white transition"
                                    >
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                        <div className="mb-8 flex justify-between items-center">
                            <div>
                                <h2 className="text-3xl font-bold text-white">My Businesses</h2>
                                <p className="mt-2 text-gray-300">Select a workspace to manage inventory, orders, and financials</p>
                            </div>
                            <button
                                onClick={() => setShowNewBusinessModal(true)}
                                className="btn-primary px-6 py-3 text-white font-semibold rounded-lg transition shadow-md"
                            >
                                + New Business
                            </button>
                        </div>

                        {/* Business Cards Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {businesses.map(business => (
                                <div
                                    key={business.id}
                                    onClick={() => openBusiness(business.id)}
                                    className="card-bg border rounded-lg shadow-md hover:shadow-xl transition cursor-pointer overflow-hidden group"
                                >
                                    <div className="p-6">
                                        <div className="flex items-start justify-between mb-4">
                                            {business.type === 'KEYBOARD_SHOP' && (
                                                <svg className="w-10 h-10 text-primary opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                                                </svg>
                                            )}
                                            {business.type === 'ELECTRONICS' && (
                                                <svg className="w-10 h-10 text-primary opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                                                </svg>
                                            )}
                                            <span className="text-xs font-medium text-gray-400 bg-gray-800 bg-opacity-50 px-2 py-1 rounded">
                                                {business.type.replace('_', ' ')}
                                            </span>
                                        </div>
                                        <h3 className="text-xl font-bold text-white mb-2 group-hover:text-primary transition">
                                            {business.name}
                                        </h3>
                                        <p className="text-gray-300 text-sm">
                                            {business.description}
                                        </p>
                                    </div>
                                    <div className="bg-gray-800 bg-opacity-50 px-6 py-3 border-t border-gray-700">
                                        <span className="text-sm text-primary font-medium">
                                            Open Workspace â†’
                                        </span>
                                    </div>
                                </div>
                            ))}

                            {/* Empty State */}
                            {businesses.length === 0 && (
                                <div className="col-span-full text-center py-12">
                                    <svg className="mx-auto h-12 w-12 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                    </svg>
                                    <h3 className="mt-2 text-sm font-medium text-white">No businesses yet</h3>
                                    <p className="mt-1 text-sm text-gray-400">Get started by creating your first business.</p>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        ReactDOM.render(<HomePage />, document.getElementById('root'));
    </script>
</body>
</html>
